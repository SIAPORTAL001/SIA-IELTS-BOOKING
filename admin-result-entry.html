<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SIA IELTS – Admin Result Entry</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#eaeaea;
}
.container{
  width:900px;
  margin:30px auto;
  background:#fff;
  padding:25px;
  box-shadow:0 5px 20px rgba(0,0,0,.2);
}
.header{
  display:flex;
  justify-content:space-between;
}
.header h1{
  margin:0;
  font-size:32px;
}
.header small{
  font-weight:bold;
}
.row{
  display:flex;
  gap:10px;
  margin-top:10px;
}
.box{
  flex:1;
}
label{
  font-size:12px;
  font-weight:bold;
}
input{
  width:100%;
  padding:6px;
  border:1px solid #000;
}
.photo-box{
  width:140px;
  height:180px;
  border:1px solid #000;
}
video,canvas{
  width:140px;
  height:180px;
}
.section-title{
  margin-top:25px;
  font-weight:bold;
  border-bottom:2px solid #000;
}
.result-grid{
  display:grid;
  grid-template-columns: repeat(6,1fr);
  gap:8px;
  margin-top:10px;
}
.big-box{
  border:1px solid #000;
  height:90px;
}
.footer{
  display:flex;
  justify-content:space-between;
  margin-top:20px;
}
button{
  padding:10px 18px;
  font-weight:bold;
  cursor:pointer;
}
.upload-btn{
  background:#000;
  color:#fff;
  float:right;
}
</style>
</head>

<body>

<script>
if(localStorage.getItem("SIA_ADMIN_LOGIN")!=="true"){
  window.location.href="admin-login.html";
}
</script>

<div class="container">

<!-- HEADER -->
<div class="header">
  <div>
    <h1>IELTS™</h1>
    <small>TEST REPORT FORM</small>
  </div>
  <div>
    <small>ACADEMIC</small>
  </div>
</div>

<!-- TOP NUMBERS -->
<div class="row">
  <div class="box">
    <label>Centre Number</label>
    <input value="SIA" readonly>
  </div>
  <div class="box">
    <label>Date</label>
    <input type="date">
  </div>
  <div class="box">
    <label>Candidate Number</label>
    <input id="candNo" readonly>
  </div>
</div>

<!-- DETAILS -->
<div class="section-title">Candidate Details</div>

<div class="row">
  <div class="box">
    <label>Family Name</label>
    <input id="family">
  </div>
  <div class="box">
    <label>First Name</label>
    <input id="first">
  </div>
  <div class="photo-box">
    <video id="video" autoplay></video>
    <canvas id="canvas" style="display:none"></canvas>
  </div>
</div>

<button onclick="capture()">Capture Photo</button>

<div class="row">
  <div class="box">
    <label>CNIC</label>
    <input id="cnic">
  </div>
  <div class="box">
    <label>Date of Birth</label>
    <input type="date">
  </div>
  <div class="box">
    <label>Sex</label>
    <input>
  </div>
  <div class="box">
    <label>Scheme Code</label>
    <input value="Private Candidate">
  </div>
</div>

<div class="row">
  <div class="box">
    <label>Country / Region</label>
    <input value="Pakistan">
  </div>
</div>

<div class="row">
  <div class="box">
    <label>First Language</label>
    <input value="Urdu">
  </div>
</div>

<!-- RESULTS -->
<div class="section-title">Test Results</div>

<div class="result-grid">
  <input id="listening" placeholder="Listening">
  <input id="reading" placeholder="Reading">
  <input id="writing" placeholder="Writing">
  <input id="speaking" placeholder="Speaking">
  <input id="overall" placeholder="Overall" readonly>
  <input id="cefr" placeholder="CEFR" readonly>
</div>

<!-- COMMENTS -->
<div class="section-title">Administrator Comments</div>
<div class="big-box"></div>

<div class="footer">
  <div>
    <label>Date</label>
    <input type="date">
  </div>
  <div>
    <label>TRF Number</label>
    <input id="trfNo" readonly>
  </div>
</div>

<button class="upload-btn" onclick="generatePDF()">Upload Result & Generate PDF</button>

</div>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
// Webcam
const video=document.getElementById("video");
const canvas=document.getElementById("canvas");

navigator.mediaDevices.getUserMedia({video:true})
.then(stream=>video.srcObject=stream);

function capture(){
  canvas.style.display="block";
  canvas.getContext("2d").drawImage(video,0,0,140,180);
}

// Auto IDs
candNo.value="SIA"+Math.floor(100000+Math.random()*900000);
trfNo.value="SIA-"+Date.now();

// PDF + SAVE
function generatePDF(){
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();

  const fullName = family.value+" "+first.value;
  const cnicVal = cnic.value;

  const l=+listening.value;
  const r=+reading.value;
  const w=+writing.value;
  const s=+speaking.value;

  const overall=((l+r+w+s)/4).toFixed(1);
  overallInput=overall;
  overallField=overall;

  let cefr="B1";
  if(overall>=6.5) cefr="C1";
  else if(overall>=6) cefr="B2";

  overall.value=overall;
  cefr.value=cefr;

  // SAVE RESULT
  localStorage.setItem(
    "SIA_RESULT_"+cnicVal,
    JSON.stringify({
      name:fullName,
      candidateNo:candNo.value,
      trfNo:trfNo.value,
      listening:l,
      reading:r,
      writing:w,
      speaking:s,
      overall:overall,
      cefr:cefr
    })
  );

  // PDF TEXT
  pdf.text("IELTS TEST REPORT FORM",20,20);
  pdf.text("Name: "+fullName,20,40);
  pdf.text("CNIC: "+cnicVal,20,50);
  pdf.text("Candidate No: "+candNo.value,20,60);
  pdf.text("TRF No: "+trfNo.value,20,70);

  pdf.text("Listening: "+l,20,90);
  pdf.text("Reading: "+r,20,100);
  pdf.text("Writing: "+w,20,110);
  pdf.text("Speaking: "+s,20,120);

  pdf.text("Overall Band: "+overall,20,140);
  pdf.text("CEFR Level: "+cefr,20,150);

  // PHOTO
  const img=canvas.toDataURL("image/png");
  pdf.addImage(img,"PNG",150,35,40,55);

  pdf.save("SIA-IELTS-TRF.pdf");
}
</script>

</body>
</html>
