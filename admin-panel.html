<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
*{box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}
body{margin:0;background:#f4f4f4}

/* HEADER */
.header{
  background:#000;
  color:#fff;
  text-align:center;
  padding:25px;
  font-size:30px;
  font-weight:bold;
}

/* TOP BUTTONS */
.top-buttons{
  display:flex;
  justify-content:center;
  gap:15px;
  padding:20px;
  flex-wrap:wrap;
}
.top-buttons button{
  padding:14px 28px;
  border:none;
  border-radius:30px;
  font-size:15px;
  cursor:pointer;
  font-weight:600;
}
.btn-book{background:#000;color:#fff}
.btn-reg{background:#f5c400}
.btn-update{background:#1976d2;color:#fff}

/* SECTIONS */
.section{display:none;padding:25px}

/* BOX */
.box{
  background:#fff;
  max-width:900px;
  margin:auto;
  padding:25px;
  border-radius:14px;
}

/* INPUTS */
input,select,textarea{
  width:100%;
  padding:11px;
  border-radius:22px;
  border:1px solid #ccc;
  margin-bottom:12px;
}

/* BUTTON */
.black-btn{
  background:#000;
  color:#fff;
  border:none;
  padding:14px;
  border-radius:30px;
  width:100%;
  font-size:16px;
  cursor:pointer;
}

/* TRF FORM */
.trf{
  border:2px solid #000;
  padding:20px;
}
.row{display:flex;gap:10px;flex-wrap:wrap}
.gray{background:#eee}

/* PHOTO BOX */
.photo-box{
  width:170px;
  height:210px;
  border:2px solid #000;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:13px;
  text-align:center;
  cursor:pointer;
  position:relative;
  overflow:hidden;
}
.photo-box video,
.photo-box canvas{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
  display:none;
}

/* RESULTS */
.results-row input{width:120px}

/* MOBILE */
@media(max-width:768px){
  .results-row input{width:100%}
}
</style>
</head>

<body>

<div class="header">WELCOME TO THE ADMIN PANEL</div>

<div class="top-buttons">
  <button class="btn-book" onclick="showSection('book')">BOOK TEST</button>
  <button class="btn-reg" onclick="showSection('reg')">Candidate Registration Form</button>
  <button class="btn-update" onclick="showSection('update')">Update Result</button>
</div>

<!-- BOOK TEST -->
<div class="section" id="book">
  <div class="box">
    <h3>Book Test</h3>
    <input placeholder="Candidate Name">
    <input type="email" placeholder="Candidate Email">
    <select>
      <option>Select Test Mode</option>
      <option>IELTS Academic</option>
      <option>IELTS General</option>
      <option>IELTS Life Skill</option>
    </select>
    <input type="date" id="testDate">
    <select>
      <option>Select Test Time</option>
      <option>10:00 AM</option><option>11:00 AM</option>
      <option>12:00 PM</option><option>01:00 PM</option>
      <option>02:00 PM</option><option>03:00 PM</option>
      <option>04:00 PM</option>
    </select>
    <button class="black-btn" onclick="bookTest()">BOOK TEST</button>
  </div>
</div>

<!-- ================= REGISTRATION ================= -->
<div class="section" id="reg">
  <div class="box">
    <h3>Welcome to the Candidate Registration Form</h3>

    <div class="trf" id="trfForm">

      <!-- MANUAL TOP BOX -->
      <input placeholder="Manual Text (Admin Use Only)">

      <div class="row">
        <div>
          <b>IELTS<sup>TM</sup></b><br>Test Report Form
        </div>
      </div>

      <br>

      <div class="row">
        Centre Number:
        <input value="PK361" readonly class="gray">

        Candidate Number:
        <input id="candidateNumber" class="gray" readonly>

        TRF Number:
        <input id="trfNumber" class="gray" readonly>
      </div>

      <hr>

      <h4>Candidate Details</h4>

      <div class="row">
        <div style="flex:1">
          Family Name:<input>
          First Name:<input>
          Candidate ID:<input>
        </div>

        <!-- PHOTO -->
       <div class="photo-box" id="photoBox">
  <span class="photo-text">Tap to Capture Photo</span>
  <video id="video" autoplay playsinline></video>
  <canvas id="canvas"></canvas>
</div>

<input id="candidateNumber" readonly>
<input id="trfNumber" readonly>
        </div>
      </div>

      <hr>

      <!-- NEW INFO -->
      <div class="row">
        Date of Birth:<input type="date" style="width:150px">
        Sex (M/F):<input style="width:70px">
        Scheme Code:<input value="Private Candidate">
      </div>

      Country / Region of Origin:
      <input>

      Country of Nationality:
      <input>

      First Language:
      <input>

      <hr>

      <h4>Test Results</h4>
      <div class="results-row">
        Listening<input>
        Reading<input>
        Writing<input>
        Speaking<input>
        Overall<input>
        CEFR<input>
      </div>

      <hr>

      <h4>Administrator Comments</h4>
      <textarea></textarea>

    </div>

    <br>

    <button class="black-btn" onclick="generatePDF()">
      Generate TRF PDF
    </button>

  </div>
</div>
<!-- ================= UPDATE RESULT ================= -->
<div class="section" id="update">
  <div class="box">
    <h3>Update Result</h3>

    <input placeholder="Listening">
    <input placeholder="Reading">
    <input placeholder="Writing">
    <input placeholder="Speaking">
    <input placeholder="Overall Band Score">
    <input placeholder="CEFR Level">

    <label>Upload TRF PDF</label>
    <input type="file" accept="application/pdf">

    <button class="black-btn"
      onclick="alert('Result Uploaded Successfully')">
      Upload Result
    </button>
  </div>
</div>

<script>
function showSection(id){
  document.querySelectorAll('.section').forEach(s=>s.style.display='none');
  document.getElementById(id).style.display='block';
}
showSection('reg');


// ==========================
// Disable Fri, Sat, Sun
// ==========================
const testDate = document.getElementById("testDate");

testDate.addEventListener("input", function () {
  const selectedDate = new Date(this.value);
  const day = selectedDate.getDay(); 
  // 0=Sunday, 5=Friday, 6=Saturday

  if (day === 0 || day === 5 || day === 6) {
    alert("Friday, Saturday and Sunday are not available");
    this.value = "";
  }
});

// ==========================
// Time options (10AM–4PM)
// ==========================
const timeSelect = document.getElementById("testTime");

const times = [
  "10:00 AM",
  "11:00 AM",
  "12:00 PM",
  "01:00 PM",
  "02:00 PM",
  "03:00 PM",
  "04:00 PM"
];

times.forEach(time => {
  const option = document.createElement("option");
  option.value = time;
  option.textContent = time;
  timeSelect.appendChild(option);
});

// ==========================
// BOOK TEST BUTTON FUNCTION
// ==========================
function bookTest() {

  const name = document.querySelector('#book input[placeholder="Candidate Name"]').value;
  const email = document.querySelector('#book input[type="email"]').value;
  const date = testDate.value;
  const time = timeSelect.value;

  if (!name || !email || !date || !time) {
    alert("Please fill all fields");
    return;
  }

  alert(
    "✅ Test Booked Successfully!\n\n" +
    "Name: " + name + "\n" +
    "Email: " + email + "\n" +
    "Date: " + date + "\n" +
    "Time: " + time
  );

  // Clear form
  document.querySelectorAll('#book input, #book select')
    .forEach(el => el.value = "");
}

document.addEventListener("DOMContentLoaded", () => {

  /* ===============================
     AUTO GENERATE NUMBERS
  =============================== */

  function generateUniqueNumber(prefix) {
    return prefix + Math.floor(100000 + Math.random() * 900000);
  }

  const candidateInput = document.getElementById("candidateNumber");
  const trfInput = document.getElementById("trfNumber");

  if (candidateInput) {
    candidateInput.value = generateUniqueNumber("CAND-");
  }

  if (trfInput) {
    trfInput.value = generateUniqueNumber("TRF-");
  }

  /* ===============================
     CAMERA CAPTURE (TAP → OPEN → TAP → CAPTURE)
  =============================== */

  const photoBox = document.getElementById("photoBox");
  const video = document.getElementById("video");
  const canvas = document.getElementById("canvas");
  const text = document.querySelector(".photo-text");

  let stream = null;
  let captured = false;

  if (photoBox) {
    photoBox.addEventListener("click", async () => {

      // FIRST TAP → OPEN CAMERA
      if (!stream && !captured) {
        try {
          stream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: "user" }
          });

          video.srcObject = stream;
          video.style.display = "block";
          text.style.display = "none";
        } catch (err) {
          alert("Camera permission denied");
        }
        return;
      }

      // SECOND TAP → CAPTURE PHOTO
      if (stream && !captured) {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext("2d").drawImage(video, 0, 0);

        stream.getTracks().forEach(track => track.stop());
        stream = null;

        video.style.display = "none";
        canvas.style.display = "block";
        captured = true;
      }
    });
  }

});

/* PDF */
function generatePDF(){
  html2pdf().from(trfForm).save("IELTS_TRF.pdf");
}
</script>

</body>
</html>